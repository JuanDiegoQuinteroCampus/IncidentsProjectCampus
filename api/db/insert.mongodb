function siguienteId(coleccion) {
  const sequenceDocument = db.counters.findOneAndUpdate(
      { _id: `${coleccion}Id` },
      { $inc: { sequence_value: 1 } },
      { returnDocument: "after" }
  );
  return sequenceDocument.sequence_value;
}
use("db_incidentsCampus");
db.incidents.insertMany([
  {
    _id:  Number(siguienteId("incidents")),
    name: "Incidente 1",
    description: "Descripci칩n del incidente 1",
    date: ISODate("2023-09-20"),
    severity: "Alta",
    zone: "Zona A",
    place: "Lugar A",
    priority: "Urgente",
    solution_date: ISODate("2023-09-21"),
    id_soporte: null,
    created_date: ISODate("2023-09-20"),
    update_date: ISODate("2023-09-20"),
    delete_date: null,
    name_User: "Juan Avila"

  },
  {
    _id:  Number(siguienteId("incidents")),
    name: "Incidente 2",
    description: "Descripci칩n del incidente 2",
    date: ISODate("2023-09-21"),
    severity: "Media",
    zone: "Zona B",
    place: "Lugar B",
    priority: "Normal",
    solution_date: null,
    id_soporte: null,
    created_date: ISODate("2023-09-21"),
    update_date: null,
    delete_date: null,
    name_User: "Juan Diego Quintero"
  },
]);

use("db_incidentsCampus");
db.support.insertMany([
  {
    _id:  Number(siguienteId("support")),
    name: "Soporte 1",
    personal: "Personal A",
    date: ISODate("2023-09-20"),
    estado: "Activo",
    id_incident: 1,
    created_date: ISODate("2023-09-20"),
    update_date: ISODate("2023-09-20"),
    delete_date: null,
    support_person: "Pepito"
  },
  {
    _id:  Number(siguienteId("support")),
    name: "Soporte 2",
    personal: "Personal B",
    date: ISODate("2023-09-21"),
    estado: "Inactivo",
    id_incident: 2,
    created_date: ISODate("2023-09-21"),
    update_date: null,
    delete_date: null,
    support_person: "Juancho"
  }
]);


use("db_incidentsCampus");
  db.users.insertMany([
    {
        CC: 1095303358,
        username: "Admin",
        password: "contrase침a",
        email:"juandiegoquintero2505@gmail.com",
        id_rol: 1
      },
      {
        CC: 345724575,
        username: "User",
        password: "contrase침a2",
        email:"Andresfajardo@gmail.com",
        id_rol: 2
      }
  ])

  use("db_incidentsCampus");
  db.incidents.find({priority: "Urgente"})

  use("db_incidentsCampus");
db.incidents.find({date:ISODate("2023-09-21")})

use("db_incidentsCampus");
db.incidents.aggregate([
  {
    $match: {
      _id: 1, 
    },
  },
  {
    $lookup: {
      from: "support",
      localField: "_id",
      foreignField: "id_incident",
      as: "support_info",
    },
  },
  {
    $unwind: "$support_info",
  },
  {
    $project: {
      _id: 1,
      name: 1,
      date: 1,
      support_person: "$support_info.support_person",
      solution_date: "$support_info.date",
    },
  },
]);


use("db_incidentsCampus");
db.support.find({estado: {$regex:/^activo$/i}})


use("db_incidentsCampus");
db.discord.find({}, {projection:{username:1, global_name:1, email:1}})